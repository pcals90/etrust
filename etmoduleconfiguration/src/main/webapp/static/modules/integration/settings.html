<!DOCTYPE html>
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Etrust | Configuración</title>
<meta name="description" content="Módulos gratis de para ecommerce">
<meta name="author" content="Carlos Lopez">

<!-- Mobile Meta -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="../../assets/images/favicon.ico">

<!-- Web Fonts -->
<link
	href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700,300&amp;subset=latin,latin-ext'
	rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Raleway:700,400,300'
	rel='stylesheet' type='text/css'>

<!-- Bootstrap core CSS -->
<link href="../../assets/bootstrap/css/bootstrap.css" rel="stylesheet">

<!-- Font Awesome CSS -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

<!-- Plugins -->
<link href="../../assets/css/animations.css" rel="stylesheet">

<!-- Worthy core CSS file -->
<link href="../../assets/css/style.css" rel="stylesheet">

<!-- Custom css -->
<link href="../../assets/css/custom.css" rel="stylesheet">



</head>
<body class="no-trans">
	<!-- scrollToTop -->
	<!-- ================ -->
	<div class="scrollToTop">
		<i class="icon-up-open-big"></i>
	</div>

	<!-- header start -->
	<!-- ================ -->
	<header class="header fixed clearfix navbar navbar-fixed-top">
		<div class="container">
			<div class="row">
				<div class="col-md-4">

					<!-- header-left start -->
					<!-- ================ -->
					<div class="header-left clearfix">

						<!-- logo -->
						<div class="logo smooth-scroll">
							<a href="../../"><img id="logo"
								src="../../assets/images/logo.png" alt="eTrust"></a>
						</div>

						<!-- name-and-slogan -->
						<div class="site-name-and-slogan smooth-scroll">
							<div class="site-name">
								<a href="#banner">e<span>Trust</span></a>
							</div>
							<div class="site-slogan">
								Incrementa la confianza <a target="_blank"
									href="http://htmlcoder.me">Link a github</a>
							</div>
						</div>

					</div>
					<!-- header-left end -->

				</div>
				<div class="col-md-8">

					<!-- header-right start -->
					<!-- ================ -->
					<div class="header-right clearfix">

						<!-- main-navigation start -->
						<!-- ================ -->
						<div class="main-navigation animated">

							<!-- navbar start -->
							<!-- ================ -->
							<nav class="navbar navbar-default" role="navigation">
								<div class="container-fluid">

									<!-- Toggle get grouped for better mobile display -->
									<div class="navbar-header">
										<button type="button" class="navbar-toggle"
											data-toggle="collapse" data-target="#navbar-collapse-1">
											<span class="sr-only">Toggle navigation</span> <span
												class="icon-bar"></span> <span class="icon-bar"></span> <span
												class="icon-bar"></span>
										</button>
									</div>

									<!-- Collect the nav links, forms, and other content for toggling -->
									<div class="collapse navbar-collapse scrollspy smooth-scroll"
										id="navbar-collapse-1">
										<ul class="nav navbar-nav navbar-right">
											<li><a href="../../">Inicio</a></li>
											<li><a href="../addition/moduleinventory.html">Adicionar módulos</a></li>
											<li><a href="../configuration/moduleconfiguration.html">Configurar módulos</a></li>
										</ul>
									</div>

								</div>
							</nav>
							<!-- navbar end -->

						</div>
						<!-- main-navigation end -->

					</div>
					<!-- header-right end -->

				</div>
			</div>
		</div>
	</header>
	<!-- header end -->

	<!-- banner start -->
	<!-- ================ -->
	<div class="banner-image-settings"></div>
	<div class="banner-caption-settings">
		<div class="container">
			<div class="row">
				<div class="col-md-8 col-md-offset-2">

					<div class="row">
						<h1 class="text-center">
							Configuración<span> Inicial</span>
						</h1>
						<p class="lead text-center">En esta página puedes configurar
							eTrust para que se conecte a la base de datos de tu ecommerce.
							Necesitamos esta información para poder evaluar la estructura de
							tu sitio y poder aconsejarte de la mejor forma en la integración
							de los módulos que selecciones. Ninguna de esta información será
							compartida ni publicada.</p>
					</div>

				</div>
			</div>


		</div>
	</div>
	<!-- banner end -->

	<!-- section start -->
	<!-- ================ -->
	<div class="section clearfix object-non-visible"
		data-animation-effect="fadeIn">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<h1 id="conexion" class="title text-left">
						Conexión a la base de<span> datos</span>
					</h1>
					<p class="lead text-left">Por favor completa la siguiente
						información sobre tu sistema ecommerce</p>
					<div class="row">

						<div class="col-md-6">

							<form role="form" id="formDBConnection">
								<div class="form-group">
									<label for="host">Host de la base de datos</label> <input
										type="text" class="form-control" id="host" name="host"
										placeholder="Ip o nombre del host, ej: 192.168.0.2" required>
								</div>

								<div class="form-group">
									<label for="port">Puerto de conexión a la base de datos</label>
									<input type="text" class="form-control" id="port" name="port"
										placeholder="Puerto de conexión, ej: 3306" required>
								</div>

								<div class="form-group">
									<label for="dbName">Nombre de la base de datos</label> <input
										type="text" class="form-control" id="dbName" name="dbName"
										placeholder="Nombre de la base de datos" required>
								</div>

								<div class="form-group">
									<label for="user">Usuario de conexión a la base de
										datos</label> <input type="text" name="user" class="form-control" id="user"
										placeholder="Usuario de conexión" required>
								</div>

								<div class="form-group">
									<label for="password">Contraseña de la base de datos</label> <input
										type="text" class="form-control" id="password" name="password"
										placeholder="Contraseña de la base de datos" required>
								</div>

								<div class="form-group">
									<label for="dbProvider">Fabricante de la base de datos</label> <select
										class="form-control" name="dbProvider" id="dbProvider" required>
										<option value="mysql">MySql</option>
									</select>
								</div>
								<button type="button" class="btn btn-default"
									data-toggle="modal" data-target="#modalInfoModulos">Guardar
									configuración</button>
								<button id="testDbConnection" type="button"
									class="btn btn-default">Probar mi
									conexión</button>
							</form>
						</div>

					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- section end -->

	<!-- section start -->
	<!-- ================ -->

	<!-- section end -->


	<!-- Modal -->
	<div id="modalInfoModulos" class="modal fade" role="dialog">
		<div class="modal-dialog modal-lg">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Recuerda adicionar y configurar tus
						módulos...</h4>
				</div>

				<div class="section translucent-bg bg-image-1 blue"
					style="padding: 25px 0px !important;">
					<div class="container">
						<h1 id="modules" class="text-center title">Módulos
							disponibles</h1>
						<div class="row" style="width: 100%">
							<div class="col-sm-6">
								<div class="media">
									<div class="media-body text-right">
										<h4 class="media-heading">Service 1</h4>
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing
											elit. Iure aperiam consequatur quo quis exercitationem
											reprehenderit dolor vel ducimus, voluptate eaque suscipit
											iste placeat.</p>
									</div>
									<div class="media-right">
										<i class="fa fa-cog"></i>
									</div>
								</div>
								<div class="media">
									<div class="media-body text-right">
										<h4 class="media-heading">Service 2</h4>
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing
											elit. Iure aperiam consequatur quo quis exercitationem
											reprehenderit dolor vel ducimus, voluptate eaque suscipit
											iste placeat.</p>
									</div>
									<div class="media-right">
										<i class="fa fa-check"></i>
									</div>
								</div>
								<div class="media">
									<div class="media-body text-right">
										<h4 class="media-heading">Service 3</h4>
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing
											elit. Iure aperiam consequatur quo quis exercitationem
											reprehenderit dolor vel ducimus, voluptate eaque suscipit
											iste placeat.</p>
									</div>
									<div class="media-right">
										<i class="fa fa-desktop"></i>
									</div>
								</div>
								<div class="media">
									<div class="media-body text-right">
										<h4 class="media-heading">Service 4</h4>
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing
											elit. Iure aperiam consequatur quo quis exercitationem
											reprehenderit dolor vel ducimus, voluptate eaque suscipit
											iste placeat.</p>
									</div>
									<div class="media-right">
										<i class="fa fa-users"></i>
									</div>
								</div>
							</div>
							<div class="space visible-xs"></div>
							<div class="col-sm-6">
								<div class="media">
									<div class="media-left">
										<i class="fa fa-leaf"></i>
									</div>
									<div class="media-body">
										<h4 class="media-heading">Service 5</h4>
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing
											elit. Iure aperiam consequatur quo quis exercitationem
											reprehenderit dolor vel ducimus, voluptate eaque suscipit
											iste placeat.</p>
									</div>
								</div>
								<div class="media">
									<div class="media-left">
										<i class="fa fa-area-chart"></i>
									</div>
									<div class="media-body">
										<h4 class="media-heading">Service 6</h4>
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing
											elit. Iure aperiam consequatur quo quis exercitationem
											reprehenderit dolor vel ducimus, voluptate eaque suscipit
											iste placeat.</p>
									</div>
								</div>
								<div class="media">
									<div class="media-left">
										<i class="fa fa-child"></i>
									</div>
									<div class="media-body">
										<h4 class="media-heading">Service 7</h4>
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing
											elit. Iure aperiam consequatur quo quis exercitationem
											reprehenderit dolor vel ducimus, voluptate eaque suscipit
											iste placeat.</p>
									</div>
								</div>
								<div class="media">
									<div class="media-left">
										<i class="fa fa-codepen"></i>
									</div>
									<div class="media-body">
										<h4 class="media-heading">Service 8</h4>
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing
											elit. Iure aperiam consequatur quo quis exercitationem
											reprehenderit dolor vel ducimus, voluptate eaque suscipit
											iste placeat.</p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>


				<div class="modal-footer">
					<div class="row">
						<div class="col-md-6 text-left">
							<button id="onlySave" type="button" class="btn btn-default"
								data-dismiss="modal">Guardar, adicionaré los módulos
								luego</button>
						</div>
						<div class="col-md-6">
							<button id="saveAndConfigure" type="button"
								class="btn btn-default" data-dismiss="modal">Guardar y
								continuar con la adición de módulos</button>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>

	<!-- Modal -->
	<div id="modalTestConnectionResult" class="modal fade" role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Probar conexión</h4>
				</div>
				<div class="container">
					<div class="row">
					<div class="col-sm-6">
						<p style="padding-top: 17px; padding-left: 23px;"
							id="testConnectionResult"></p>
					</div>
					</div>
				</div>
				<div class="modal-footer">
					<div class="row">
						<div class="col-md-1">
							<button type="button" class="btn btn-default"
								data-dismiss="modal">Cerrar</button>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>
	
	<!-- Modal -->
	<div id="modalSaveConnectionResult" class="modal fade" role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Guardar conexión</h4>
				</div>
				<div class="container">
					<div class="row">
						<p style="padding-top: 17px; padding-left: 23px;"
							id="saveConnectionResult"></p>
					</div>
				</div>
				<div class="modal-footer">
					<div class="row">
						<div class="col-md-1">
							<button id = "closeSaveStatus" type="button" class="btn btn-default"
								data-dismiss="modal">Volver al inicio</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
		
		<!-- Modal -->
	<div id="modalSaveConnectionResultAdd" class="modal fade" role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Guardar conexión</h4>
				</div>
				<div class="container">
					<div class="row">
						<p style="padding-top: 17px; padding-left: 23px;"
							id="saveConnectionResultAdd"></p>
					</div>
				</div>
				<div class="modal-footer">
					<div class="row">
						<div class="col-md-1">
							<button id = "closeSaveStatusAdd" type="button" class="btn btn-default"
								data-dismiss="modal">Ir a configurar mis módulos</button>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>

	<!-- JavaScript files placed at the end of the document so the pages load faster
		================================================== -->
	<!-- Jquery and Bootstap core js files -->
	<script type="text/javascript" src="../../assets/plugins/jquery.min.js"></script>
	<script type="text/javascript"
		src="../../assets/bootstrap/js/bootstrap.min.js"></script>

	<!-- Modernizr javascript -->
	<script type="text/javascript" src="../../assets/plugins/modernizr.js"></script>

	<!-- Isotope javascript -->
	<script type="text/javascript"
		src="../../assets/plugins/isotope/isotope.pkgd.min.js"></script>

	<!-- Backstretch javascript -->
	<script type="text/javascript"
		src="../../assets/plugins/jquery.backstretch.min.js"></script>

	<!-- Appear javascript -->
	<script type="text/javascript"
		src="../../assets/plugins/jquery.appear.js"></script>

	<!-- Initialization of Plugins -->
	<script type="text/javascript" src="../../assets/js/template.js"></script>

	<!-- Custom Scripts -->
	<script type="text/javascript" src="../../assets/js/custom.js"></script>
	
	<script>
		$(document).ready(
			function() {
				
			$.get("/etmoduleconfiguration/initialconf/getExistingConfiguration").done(function(data){
				
				if(!data.response) return;
				
				$("#host").val(data.response.host);
				$("#port").val(data.response.port);
				$("#dbName").val(data.response.dbName);
				$("#user").val(data.response.user);
				$("#password").val(data.response.password);
				
				var provider = data.response.dbProvider;
				$("select dbProvider").filter(function() {
				    //may want to use $.trim in here
				    return $(this).text() == provider; 
				}).prop('selected', true);
				
				
			});
				
			$("#testDbConnection").click(
			function(event) {
				
				var form = $("#formDBConnection");
				
				if(!validateDBConnectionForm(this)) {
					return;
				};
				
				$.post("/etmoduleconfiguration/initialconf/testConnection",form.serialize()).
					done(function(data) {
						if (data.response)
							$("#testConnectionResult").html("Conexión exitosa");
						else
							$("#testConnectionResult").html("No pudimos establecer comunicación con"+ 
									" tu base de datos. Por favor verifica los parámetros de conexión");
						
						$("#modalTestConnectionResult").modal("show");
					}).fail(function(error) {
							$("#testConnectionResult").html("Ocurrio un error llamando nuestros servicios."+
									" Por favor intenta nuevamente.");
							$("#modalTestConnectionResult").modal("show");
						});

			});

			$("#onlySave").click(function() {
				
				var form = $("#formDBConnection");
				
				if(!validateDBConnectionForm(this)) {
					return;
				};
				
				$.ajax({
					  type: "POST",
					  url: "/etmoduleconfiguration/initialconf/saveNewInitialConfiguration",
					  data: JSON.stringify(form.serializeObject()),
					  success: function(data) {
							$("#saveConnectionResult").html("Datos guardados correctamente.");
							$("#modalSaveConnectionResult").modal("show");
							
					   },
					   fail: function(error) {
							$("#testConnectionResult").html("Ocurrio un error llamando nuestros servicios."+
									" Por favor intenta nuevamente.");
							$("#modalTestConnectionResult").modal("show");
						},
					   dataType: "json",
					  headers: { 
					        'Accept': 'application/json',
					        'Content-Type': 'application/json' 
					    }
					  
					});
				 
				
			});
			
			$("#closeSaveStatus").click(function(){
				window.location.href = "/etmoduleconfiguration/static";
			});
			
			$("#saveAndConfigure").click(function() {

				var form = $("#formDBConnection");
				
				if(!validateDBConnectionForm(this)) {
					return;
				};
				
				$.ajax({
					  type: "POST",
					  url: "/etmoduleconfiguration/initialconf/saveNewInitialConfiguration",
					  data: JSON.stringify(form.serializeObject()),
					  dataType: "json",
					  success: function(data) {
							$("#saveConnectionResultAdd").html("Datos guardados correctamente.");
							$("#modalSaveConnectionResultAdd").modal("show");
							
					   },
					  headers: { 
					        'Accept': 'application/json',
					        'Content-Type': 'application/json' 
					    }
					  
					});
				
				
			});
			
			$("#closeSaveStatusAdd").click(function(){
				window.location.href = "../addition/moduleinventory.html";
			});

		});
		
		function validateDBConnectionForm(form){
			var formOk = true;
			
			$(".missingField").remove();
			
			if($("#host").val() == ""){
				formOk = false;
				$("#host").addClass("has-error");
				$("#host").after("<p class='missingField' style='color:red'>Por favor completa este campo.</p>")
			}
			
			if($("#port").val() == ""){
				formOk = false;
				$("#port").addClass("has-error");
				$("#port").after("<p class='missingField' style='color:red'>Por favor completa este campo.</p>")
			}
			
			if($("#dbName").val() == ""){
				formOk = false;
				$("#dbName").addClass("has-error");
				$("#dbName").after("<p class='missingField' style='color:red'>Por favor completa este campo.</p>")
			}
			
			if($("#user").val() == ""){
				formOk = false;
				$("#user").addClass("has-error");
				$("#user").after("<p class='missingField' style='color:red'>Por favor completa este campo.</p>")
			}
			
			if($("#password").val() == ""){
				formOk = false;
				$("#password").addClass("has-error");
				$("#password").after("<p class='missingField' style='color:red'>Por favor completa este campo.</p>")
			}
			
			if($("#dbProvider").val() == ""){
				formOk = false;
				$("#dbProvider").addClass("has-error");
				$("#dbProvider").after("<p class='missingField' style='color:red'>Por favor completa este campo.</p>")
			}
			
			
			return formOk;
		}
		
		$.fn.serializeObject = function()
		{
		    var o = {};
		    var a = this.serializeArray();
		    $.each(a, function() {
		        if (o[this.name] !== undefined) {
		            if (!o[this.name].push) {
		                o[this.name] = [o[this.name]];
		            }
		            o[this.name].push(this.value || '');
		        } else {
		            o[this.name] = this.value || '';
		        }
		    });
		    return o;
		};
		
	</script>
	
	
</body>

</html>
<!DOCTYPE html>
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Etrust | Configuración de módulos</title>
<meta name="description" content="Módulos gratis de para ecommerce">
<meta name="author" content="Carlos Lopez">

<!-- Mobile Meta -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="../../assets/images/favicon.ico">

<!-- Web Fonts -->
<link
	href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700,300&amp;subset=latin,latin-ext'
	rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Raleway:700,400,300'
	rel='stylesheet' type='text/css'>

<!-- Bootstrap core CSS -->
<link href="../../assets/bootstrap/css/bootstrap.css" rel="stylesheet">

<!-- Font Awesome CSS -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

<!-- Plugins -->
<link href="../../assets/css/animations.css" rel="stylesheet">

<!-- Worthy core CSS file -->
<link href="../../assets/css/style.css" rel="stylesheet">

<!-- Custom css -->
<link href="../../assets/css/custom.css" rel="stylesheet">

<link rel="icon" type="image/png" href="../../assets/img/favicon.ico">
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" />
<link href="../../assets/css/gsdk-base.css" rel="stylesheet" />

</head>
<body class="no-trans">
	<!-- scrollToTop -->
	<!-- ================ -->
	<div class="scrollToTop">
		<i class="icon-up-open-big"></i>
	</div>

	<!-- header start -->
	<!-- ================ -->
	<header class="header fixed clearfix navbar navbar-fixed-top">
		<div class="container">
			<div class="row">
				<div class="col-md-4">

					<!-- header-left start -->
					<!-- ================ -->
					<div class="header-left clearfix">

						<!-- logo -->
						<div class="logo smooth-scroll">
							<a href="../../"><img id="logo"
								src="../../assets/images/logo.png" alt="eTrust"></a>
						</div>

						<!-- name-and-slogan -->
						<div class="site-name-and-slogan smooth-scroll">
							<div class="site-name">
								<a href="#banner">e<span>Trust</span></a>
							</div>
							<div class="site-slogan">
								Incrementa la confianza <a target="_blank"
									href="http://htmlcoder.me">Link a github</a>
							</div>
						</div>

					</div>
					<!-- header-left end -->

				</div>
				<div class="col-md-8">

					<!-- header-right start -->
					<!-- ================ -->
					<div class="header-right clearfix">

						<!-- main-navigation start -->
						<!-- ================ -->
						<div class="main-navigation animated">

							<!-- navbar start -->
							<!-- ================ -->
							<nav class="navbar navbar-default" role="navigation">
								<div class="container-fluid">

									<!-- Toggle get grouped for better mobile display -->
									<div class="navbar-header">
										<button type="button" class="navbar-toggle"
											data-toggle="collapse" data-target="#navbar-collapse-1">
											<span class="sr-only">Toggle navigation</span> <span
												class="icon-bar"></span> <span class="icon-bar"></span> <span
												class="icon-bar"></span>
										</button>
									</div>

									<!-- Collect the nav links, forms, and other content for toggling -->
									<div class="collapse navbar-collapse scrollspy smooth-scroll"
										id="navbar-collapse-1">
										<ul class="nav navbar-nav navbar-right">
											<li><a href="../../">Inicio</a></li>
											<li><a href="../integration/settings.html">Configuración
													inicial</a></li>
											<li><a href="../addition/moduleconfiguration.html">Configurar
													módulos</a></li>
										</ul>
									</div>

								</div>
							</nav>
							<!-- navbar end -->

						</div>
						<!-- main-navigation end -->

					</div>
					<!-- header-right end -->

				</div>
			</div>
		</div>
	</header>
	<!-- header end -->

	<!-- banner start -->
	<!-- ================ -->
	<div class="banner-image-settings-module"></div>
	<div class="banner-caption-settings">
		<div class="container">
			<div class="row">
				<div class="col-md-8 col-md-offset-2">

					<div class="row">
						<h1 class="text-center">
							Configurar<span> Módulos</span>
						</h1>
						<p class="lead text-center">
							En esta página puedes configurar y personalizar la forma como
							etrust integra los módulos que habilitaste en <a
								href="../addition/moduleinventory.html">Adicionar módulos.</a>
							Para poder utlizar esta funcionalidad, debes haber configurado la
							<a href="../integration/settings.html">conexión</a> a tu base de
							datos previamente.
						</p>
					</div>


				</div>
			</div>


		</div>
	</div>
	<!-- banner end -->

	<!-- section start -->
	<!-- ================ -->
	<div class="section clearfix object-non-visible"
		data-animation-effect="fadeIn">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="row">
						<h1 id="conexion" class="title text-left">
							Módulos<span> habilitados</span>
						</h1>
					</div>

					<div class="row">
						<div class=" col-md-6">
							<label for="addedModules">Por favor selecciona el módulo
								que deseas configuar</label> <select class="form-control"
								name="addedModules" id="addedModules">
							</select> <br />
							<a href="#configurationModuleRow" id="btnConfigureModule" class="btn btn-default">Configurar</a>
						</div>
					</div>

					<div class="row" id="configurationModuleRow" style="display:none">
						<div class="col-sm-12">
							<div class="wizard-container">
								<div class="card wizard-card ct-wizard-azzure" id="wizard">
									<form id="formModuleInformation">
										<div class="wizard-header">
											<h3>
												Calificación de <span>productos</span> <br /> <small>Con
													ésta información integraremos tus productos en etrust.</small>
											</h3>
										</div>
										<ul>
											<li><a href="#productsInformation" data-toggle="tab">Productos</a></li>
											<li><a href="#salesInformation" data-toggle="tab">Ventas</a></li>
											<li><a href="#clientsInformation" data-toggle="tab">Clientes</a></li>
											<li><a href="#infoIntegration" data-toggle="tab">Integración
													con etrust</a></li>
										</ul>

										<div class="tab-content">
											<div class="tab-pane" id="productsInformation">
												<div class="row">
													<div class="col-sm-12">
														<h4 class="info-text">Información de tu tabla de
															productos</h4>
													</div>
													<div class="row">
														<div class="col-sm-5 col-sm-offset-1">
															<div class="form-group">
																<label for="dbProductTables">Nombre de la tabla</label><select required
																	class="form-control" name="dbProductTables" id="dbProductTables">
																</select>
															</div>
														</div>
													</div>
													<div class="row">
														<div class="col-sm-10 col-sm-offset-1">
															<div class="form-group">
																<label for="dbProductColumns">Llave primaria</label><select required
																	class="form-control dbInformation" name="dbProductColumns"
																	id="dbProductColumns" multiple>
																</select> (Presiona Ctrl para seleccionar varios campos)
															</div>
														</div>

													</div>
												</div>
											</div>
											<div class="tab-pane" id="salesInformation">
												<div class="row">
													<div class="col-sm-12">
														<h4 class="info-text">Información de tu tabla de
															ventas</h4>
													</div>
													<div class="row">
														<div class="col-sm-5 col-sm-offset-1">
															<div class="form-group">
																<label for="dbSaleTables">Nombre de la tabla</label><select required
																	class="form-control" name="dbSaleTables" id="dbSaleTables">
																</select>
															</div>
														</div>
													</div>
													<div class="row">
														<div class="col-sm-10 col-sm-offset-1">
															<div class="form-group">
																<label for="dbInformation">Llave primaria</label><select required
																	class="form-control dbInformation" name="dbSaleColumns"
																	id="dbSaleColumns" multiple>
																</select> (Presiona Ctrl para seleccionar varios campos)
															</div>
														</div>

													</div>
												</div>
											</div>
											<div class="tab-pane" id="clientsInformation">

												<div class="row">
													<div class="col-sm-12">
														<h4 class="info-text">Información de tu tabla de
															clientes</h4>
													</div>
													<div class="row">
														<div class="col-sm-5 col-sm-offset-1">
															<div class="form-group">
																<label for="dbClientTables">Nombre de la tabla</label><select required
																	class="form-control" name="dbClientTables" id="dbClientTables">
																</select>
															</div>
														</div>
													</div>
													<div class="row">
														<div class="col-sm-10 col-sm-offset-1">
															<div class="form-group">
																<label for="addedModules">Llave primaria</label><select required
																	class="form-control dbInformation" name="dbClientColumns"
																	id="dbClientColumns" multiple>
																</select> (Presiona Ctrl para seleccionar varios campos)
															</div>
														</div>

													</div>
												</div>
											</div>


											<div class="tab-pane active" id="infoIntegration">
												<div class="row">
													<div class="col-sm-12">
														<h4 class="info-text">¿Qué información deseas
															adicionar a tu sistema?</h4>
													</div>
													<div class="form-group">
														<div class="col-sm-11" id="divFuncionalities">
															<div class="row">
																<div class="col-sm-3">
																	<div class="checkbox">
																		<label> <input type="checkbox" value="1">Titulo de calificación
																		</label>
																	</div>
																</div>
																
																<div class="col-sm-3">
																	<div class="checkbox">
																		<label> <input type="checkbox" value="2">Comentario general
																		</label>
																	</div>
																</div>
																
																<div class="col-sm-3">
																	<div class="checkbox">
																		<label> <input type="checkbox" value="3">Calificación del producto
																		</label>
																	</div>
																</div>
																
																<div class="col-sm-3">
																	<div class="checkbox">
																		<label> <input type="checkbox" value="4">Calificación de servicio al cliente
																		</label>
																	</div>
																</div>
															</div>
															
															<div class="row">
																<div class="col-sm-3">
																	<div class="checkbox">
																		<label> <input type="checkbox" value="5">Satisfacción general
																		</label>
																	</div>
																</div>
																
																<div class="col-sm-3">
																	<div class="checkbox">
																		<label> <input type="checkbox" value="6">Pros del producto
																		</label>
																	</div>
																</div>
																
																<div class="col-sm-3">
																	<div class="checkbox">
																		<label> <input type="checkbox" value="7">Contras del producto
																		</label>
																	</div>
																</div>
																
																<div class="col-sm-3">
																	<div class="checkbox">
																		<label> <input type="checkbox" value="8">Mejores usos del producto
																		</label>
																	</div>
																</div>
															</div>
															
															<div class="row">
																<div class="col-sm-3">
																	<div class="checkbox">
																		<label> <input type="checkbox" value="9">Recomendaría a un amigo
																		</label>
																	</div>
																</div>
																
																<div class="col-sm-3">
																	<div class="checkbox">
																		<label> <input type="checkbox" value="10">Compraría de nuevo el producto
																		</label>
																	</div>
																</div>
																
																<div class="col-sm-3">
																	<div class="checkbox">
																		<label> <input type="checkbox" value="11">Fecha de calificación
																		</label>
																	</div>
																</div>
																
																<div class="col-sm-3">
																	<div class="checkbox">
																		<label> <input type="checkbox" value="12">Utilidad del producto
																		</label>
																	</div>
																</div>
															</div>
															
														</div>


													</div>

												</div>
											</div>

										</div>
										<div class="wizard-footer">
											<div class="pull-right">
												<input type='button'
													class='btn btn-next btn-fill btn-info btn-wd btn-sm'
													name='next' value='Siguiente' /> <input id="saveSettings" type='button'
													class='btn btn-finish btn-fill btn-info btn-wd btn-sm'
													name='finish' value='Guardar' />

											</div>
											<div class="pull-left">
												<input type='button'
													class='btn btn-previous btn-fill btn-default btn-wd btn-sm'
													name='previous' value='Atrás' />
											</div>
											<div class="clearfix"></div>
										</div>
									</form>
								</div>
							</div>
							<!-- wizard container -->
						</div>
					</div>




				</div>
			</div>
		</div>
		<!-- Modal -->
	
	</div>
	<!-- section end -->

	<div id="modalResults" class="modal" role="dialog">
			<div class="modal-dialog">
	
				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Configurar módulo</h4>
					</div>
					<div class="container">
						<div class="row">
						<div class="col-sm-6">
							<p style="padding-top: 17px; padding-left: 23px;"
								id="contentModalResults"></p>
						</div>
						</div>
					</div>
					<div class="modal-footer">
						<div class="row">
							<div class="col-md-1">
								<button type="button" class="btn btn-default"
									data-dismiss="modal">Cerrar</button>
							</div>
						</div>
					</div>
				</div>
	
			</div>
		</div>
	

	<!-- JavaScript files placed at the end of the document so the pages load faster
		================================================== -->
	<!-- Jquery and Bootstap core js files -->
	<script type="text/javascript" src="../../assets/plugins/jquery.min.js"></script>
	<script type="text/javascript"
		src="../../assets/bootstrap/js/bootstrap.min.js"></script>

	<!-- Modernizr javascript -->
	<script type="text/javascript" src="../../assets/plugins/modernizr.js"></script>

	<!-- Isotope javascript -->
	<script type="text/javascript"
		src="../../assets/plugins/isotope/isotope.pkgd.min.js"></script>

	<!-- Backstretch javascript -->
	<script type="text/javascript"
		src="../../assets/plugins/jquery.backstretch.min.js"></script>

	<!-- Appear javascript -->
	<script type="text/javascript"
		src="../../assets/plugins/jquery.appear.js"></script>

	<!-- Initialization of Plugins -->
	<script type="text/javascript" src="../../assets/js/template.js"></script>

	<!-- Custom Scripts -->
	<script type="text/javascript" src="../../assets/js/custom.js"></script>

	<!--   plugins 	 -->
	<script src="../../assets/js/jquery.bootstrap.wizard.js"
		type="text/javascript"></script>

	<!--  More information about jquery.validate here: http://jqueryvalidation.org/	 -->
	<script src="../../assets/js/jquery.validate.min.js"></script>

	<!--  methods for manipulating the wizard and the validation -->
	<script src="../../assets/js/wizard.js"></script>

	<script>
		$(document).ready(function() {

			var yaLoTiene = false;
			var moduleId;
			$.ajax({
				type : "GET",
				url : "/etmoduleconfiguration/initialconf/getActiveModules",
				dataType : "json",
				data : {},
				success : function(data) {

					if (!data.response)
						return;

					$.each(data.response, function(i, item) {
						$('#addedModules').append($('<option>', {
							value : item.moduleId,
							text : item.moduleName
						}));
					});
				}
			});
			
			
			
			$("#dbProductTables").change(function (event){
				
				function addData(columns){
					
					$("#dbProductColumns").empty();
					
					$.each(columns,function(i,item){
						var selected = false;
						var text = item.columnName;
						if(item.columnKey && item.columnKey != ""){
							text += "("+item.columnKey+")";
							
							if(item.columnKey == "PRI"){
								selected = true;
							}
						}
						$("#dbProductColumns").append($('<option>', {
							value : item.columnName,
							text : text
						}));
						
						if(selected)
						$("#dbProductColumns option[value="+ item.columnName+"]").attr('selected','selected');
						
					});
				}
				
				var tableName = $("#dbProductTables option:selected").text();
				$.get("/etmoduleconfiguration/initialconf/getColumnInformationByTableName",{'tableName':tableName}).done(function(data){
				
					addData(data.response);
			});
				
				
			});
			
			$("#dbSaleTables").change(function (event){
							
				function addData(columns){
					
					$("#dbSaleColumns").empty();
					
					$.each(columns,function(i,item){
						var selected = false;
						var text = item.columnName;
						if(item.columnKey && item.columnKey != ""){
							text += "("+item.columnKey+")";
							
							if(item.columnKey == "PRI"){
								selected = true;
							}
						}
						$("#dbSaleColumns").append($('<option>', {
							value : item.columnName,
							text : text
						}));
						
						if(selected)
						$("#dbSaleColumns option[value="+ item.columnName+"]").attr('selected','selected');
						
					});
				}
				
				var tableName = $("#dbSaleTables option:selected").text();
				$.get("/etmoduleconfiguration/initialconf/getColumnInformationByTableName",{'tableName':tableName}).done(function(data){
				
					addData(data.response);
			});
							
			});
			
			$("#dbClientTables").change(function (event){
				
					function addData(columns){
					
					$("#dbClientColumns").empty();
					
					$.each(columns,function(i,item){
						var selected = false;
						var text = item.columnName;
						if(item.columnKey && item.columnKey != ""){
							text += "("+item.columnKey+")";
							
							if(item.columnKey == "PRI"){
								selected = true;
							}
						}
						$("#dbClientColumns").append($('<option>', {
							value : item.columnName,
							text : text
						}));
						
						if(selected)
						$("#dbClientColumns option[value="+ item.columnName+"]").attr('selected','selected');
						
					});
				}
				
				var tableName = $("#dbClientTables option:selected").text();
				$.get("/etmoduleconfiguration/initialconf/getColumnInformationByTableName",{'tableName':tableName}).done(function(data){
				
					addData(data.response);
			});
				
			});
			
			
			$("#saveSettings").click(function (){
				
				var checks = $("#divFuncionalities :checkbox");
				
				var metadata = {};
				
				var table = {'tableName':$("#dbProductTables option:selected").val()};
				var columns = [];
				var tables = [];
				$("#dbProductColumns option:selected").each(function (){
					var item = $(this);
					var col = {};
					if(item.html().indexOf("(PRI)") > 1){
						col.columnKey = "PRI";
					}
					
					col.columnName = item.html().replace("(PRI)","");
					col.columnName = col.columnName.replace("(MUL)","");
					columns.push(col);
				});
				
				var funcs =[];
				$.each(checks, function(i,item){
					funcs.push({"id":item.value,"status":(item.checked?'active':'inactive'),"moduleId":1});
				});
				
				table.columns = columns;

				tables.push(table);
				metadata.tables= tables;
				metadata.functionalities = funcs;
				metadata.moduleId = $("#addedModules").val();
				
				$.ajax({
					type: "POST",
					url : "/etmoduleconfiguration/initialconf/saveConfiguration",
					dataType : "json",
					data : JSON.stringify(metadata),
					contentType: "application/json",
					success: function (data){
						if(data.response)
							$("#contentModalResults").html('Datos guardados correctamente. El módulo "Calificación de productos" está disponible para tu solución ecommerce.');
						else
							$("#contentModalResults").html("Ocurrió un error actualizando tu información. Intenta nuevamente.");
							$("#modalResults").modal("show");
						
						
					}
				});
				
			});

			$("#btnConfigureModule").click(function(event) {
				
				
				$.get("/etmoduleconfiguration/initialconf/getAllTables").done(function(data){
					
					if(!data.response) return;
					
					$('#dbProductTables').empty();
					$('#dbSaleTables').empty();
					$('#dbClientTables').empty();
					
					$.each(data.response,function(i,item){
						$('#dbProductTables').append($('<option>', {
							value : item.tableName,
							text : item.tableName
						}));
						
						$('#dbSaleTables').append($('<option>', {
							value : item.tableName,
							text : item.tableName
						}));
						
						$('#dbClientTables').append($('<option>', {
							value : item.tableName,
							text : item.tableName
						}));
					});
					
				}).fail(function(){
					console.log(":(");
				});
					
					
				$.ajax({
					  type: "GET",
					  url: "/etmoduleconfiguration/initialconf/getFunctionalitiesByModuleId",
					  data: {"moduleId":1},
					  dataType: "json",
					  success: function(data) {
						  if (!data.response) return;
						  $.each(data.response, function(i,item){
							  
							  var checkbox = $("#divFuncionalities :checkbox[value="+item.id+"]");
							  
							  if(item.status=='active')
							  	checkbox.prop('checked', true);
							  else
							    checkbox.prop('checked',false);
							  
						  });
							
					   }
				});
				
				$("#configurationModuleRow").show();

			});

		});
			
	</script>


</body>

</html>
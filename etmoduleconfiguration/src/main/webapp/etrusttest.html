var etrustServices = new EtrustServicesEnum();

function EtrustServicesEnum() {
    this.PRDUCT_REVIEW = "presale_productreview";
}

function Etrust(serviceName,element){
    
var etHost = "http://localhost:8080/etmoduleconfiguration/",
etUser = "prestashop",
etPass = "prestashop",
service = serviceName,
getPresaleMetadata = "etapi/presale/getFunctionalities",
addReviewURL = "etapi/presale/productreview/add",
productReviewServiceName = "/presale/productreview/create",
getProductReviewUrl="etapi/presale/productreview/getReview",
rateComment="/etapi/presale/productreview/rate",
metaData,
formId;

    getModuleMetaData(serviceName);

function getModuleMetaData(service){

    var self = this;
    $.ajax({
        type:"GET",
        url:  etHost +  getPresaleMetadata,
        data: {"serviceName":service},
        success: function(data){
            if(data.response && data.response.length > 0)
            metaData = data.response[0];
            addEtrustSaveComponents();
        },
        fail: function(data){
            console.log("Error in ETRUST" + data);
        }
    });
}

function addEtrustSaveComponents(){

    var ele = $("#"+element);
    ele.html("");
    
    
    if(!metaData || metaData.functionalities.length == 0) return;
    
    formId = metaData.serviceName;
    var htmlData = openForm(formId);
    $.each(metaData.functionalities,function(i,item){
        
        switch (item.htmlElement){
            
            case "forminputtext":
                htmlData += addFormInputText(ele,item);
                break;
            case "forminputarea":
                htmlData += addFormArea(ele,item);
            break;
            case "formstars":
                htmlData += addFormStars(ele,item);
            break;
            case "formcheck":
                htmlData += addFormCheck(ele,item);
            break;
            case "formdate":
                htmlData += addFormDate(ele,item);
            break;
        }
       
    });
     htmlData += closeForm();
     ele.append(htmlData);
    
}
    function openForm(id){
        return "<form id='"+id+"' style=width:85%;margin-left:5%;>";
    }
    
    function closeForm(){
        return "</form>"
    }
    
    function addFormArea(element,item){
        
        var input = "<div class = 'form-group'>\n";
        input += "<label for='"+item.visualId+"'>"+item.name+"</label>\n";
        input += "<textarea class='form-control' rows='3' id='"+item.visualId+"'></textarea>\n";
        input +='</div>\n';
        
        return input;
    }
    
    function addFormStars(element,item){
        
        var input = "<div class = 'form-group'>\n";
        input += "<label for='"+item.visualId+"'>"+item.name+"</label>\n";
        
            input +='<div class="star_content">';

                input +='<input class="star not_uniform" style="margin-right: 2px; height:inherit; width:inherit;" type="radio" value="1" />\n';
                input +='<input class="star not_uniform" style="margin-right: 2px; height:inherit; width:inherit;" type="radio" value="2" />\n';
                input +='<input class="star not_uniform" style="margin-right: 2px; height:inherit; width:inherit;" type="radio" value="3" />\n';
                input +='<input class="star not_uniform" style="margin-right: 2px; height:inherit; width:inherit;" type="radio" value="4" />\n';
                input +='<input class="star not_uniform" style="margin-right: 2px; height:inherit; width:inherit;" type="radio" value="5" />\n';
                input +='<div class="clearfix"></div>';
        
            input +='</div>\n';
        input +='</div>\n';
        

        return input;
    }
    
    function addFormCheck(element,item){
        
        var input = "<div class = 'checkbox'>\n";
        input += "<label>\n";
        input += "<input type='checkbox' id="+item.visualId+" style='width: inherit;height: inherit;'>\n";
        input += item.name;
        input += "</label>\n";
        input +='</div>\n';
        
        return input;
    }
    
    function addFormDate(element,item){
        
        var input = "<div class = 'form-group'>\n";
        input += "<label for='"+item.visualId+"'>"+item.name+"</label>\n";
        input += "<input type='date' class='form-control' id='"+item.visualId+"' placeholder="+item.name+">\n";
        input +='</div>\n';
        
        return input;
    }
    
    function addFormInputText(element,item){
        
        var input = "<div class = 'form-group'>\n";
        input += "<label for='"+item.visualId+"'>"+item.name+"</label>\n";
        input += "<input type='text' class='form-control' id='"+item.visualId+"' placeholder="+item.name+">\n";
        input +='</div>';
        
        return input;
    }

    

function getProductReview(pid, customerId, saleId,element){
    var url =  etHost +  getProductReviewUrl;
    $.ajax({
            type:"GET",
            url:  etHost +  getProductReviewUrl +"?productId="+pid,
            contentType: "application/json",
            success: function(data){
                console.log("ys");
            },
            fail: function(data){
                console.log("Error in ETRUST" + data);
            }
        });
}

function rateComment(reviewId,rate){
    var rate = {"reviewId":reviewId,"rate":rate};

    $.ajax({

        type:"POST",
        url:  etHost +  rateComment,
        data : JSON.stringify(rate),
        contentType: "application/json",
        success: function(data){
            console.log("success");
        }
    });

}
    
function saveProductReview(productId, customerId, saleId){
    var review = {productId:productId, customerId:customerId, saleId:saleId};
        
    $.each(metaData[0].functionalities,function(i,item){
        
        
        var element = $("#"+item.visualId);
        var value = element.val();
        
        if(value && value.length > 0)
        switch (item.htmlElement){
            case "inputtext":
                review[item.visualId] = value;
                break;
        }
        
        
    });
    
    $.ajax({
            type: "POST",
            url:  etHost +  addReviewURL,
            dataType : "json",
            data : JSON.stringify(review),
            contentType: "application/json",
            success: function(data){
                alert("test");
            }
        });
        
    
}   
}